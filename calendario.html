<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Planner Minimalista</title>
<style>
  
  body {
    font-family: sans-serif;
    margin: 0;
    padding: 0;
  }

  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    border-bottom: 1px solid #ddd;
  }

  .calendar {
    max-width: 1000px;
    margin: 20px auto;
  }

  #weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    text-align: center;
    font-weight: 600;
    border-bottom: 1px solid #ccc;
    padding-bottom: 4px;
  }

  #grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    border: 1px solid #ccc;
    border-top: none;
  }

  .cell {
    border-right: 1px solid #ccc;
    border-bottom: 1px solid #ccc;
    min-height: 120px;
    padding: 6px;
    display: flex;
    flex-direction: column;
  }

  .cell:nth-child(7n) { border-right: none; }

  .daynum {
    font-weight: bold;
    margin-bottom: 4px;
  }

  .entries {
    flex: 1;
    outline: none;
  }

  .today {
    background: rgba(0, 0, 0, 0.05);
  }

  .dim {
    color: #aaa;
  }

  button {
    cursor: pointer;
  }

  @media (max-width: 700px) {
    #weekdays, #grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
</style>
</head>
<body>

<header>
  <h2 id="monthTitle">Mês Atual</h2>
  <div>
    <button id="prev">◀</button>
    <button id="todayBtn">Hoje</button>
    <button id="next">▶</button>
  </div>
</header>

<div class="calendar">
  <div id="weekdays"></div>
  <div id="grid"></div>
</div>

<script>
const grid = document.getElementById('grid');
const weekdaysEl = document.getElementById('weekdays');
const monthTitle = document.getElementById('monthTitle');
const prevBtn = document.getElementById('prev');
const nextBtn = document.getElementById('next');
const todayBtn = document.getElementById('todayBtn');

let today = new Date();
let viewYear = today.getFullYear();
let viewMonth = today.getMonth();

const weekdays = ['Dom','Seg','Ter','Qua','Qui','Sex','Sáb'];

function formatDateYMD(d){
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,'0');
  const day = String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}

function saveEntry(dateStr, html){
  localStorage.setItem('planner-'+dateStr, html);
}
function loadEntry(dateStr){
  return localStorage.getItem('planner-'+dateStr) || '';
}

function buildWeekdays(){
  weekdaysEl.innerHTML = '';
  weekdays.forEach(w => {
    const el = document.createElement('div');
    el.textContent = w;
    weekdaysEl.appendChild(el);
  });
}

function renderCalendar(year, month){
  grid.innerHTML = '';
  const first = new Date(year, month, 1);
  const last = new Date(year, month+1, 0);
  const startDayIndex = first.getDay();
  const startDate = new Date(year, month, 1 - startDayIndex);
  const total = 42;

  monthTitle.textContent = first.toLocaleString('pt-BR', {month:'long', year:'numeric'});

  for(let i=0;i<total;i++){
    const d = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate() + i);
    const cell = document.createElement('div');
    cell.className = 'cell';
    if(d.getMonth() !== month) cell.classList.add('dim');
    if(d.toDateString() === new Date().toDateString()) cell.classList.add('today');

    const dayHeader = document.createElement('div');
    dayHeader.className = 'daynum';
    dayHeader.textContent = d.getDate();
    cell.appendChild(dayHeader);

    const entries = document.createElement('div');
    entries.className = 'entries';
    entries.setAttribute('data-date', formatDateYMD(d));
    entries.contentEditable = true;
    entries.spellcheck = false;
    entries.innerHTML = loadEntry(formatDateYMD(d)) || '';
    cell.appendChild(entries);

    let saveTimer = null;
    entries.addEventListener('input', () => {
      clearTimeout(saveTimer);
      saveTimer = setTimeout(() => {
        saveEntry(entries.getAttribute('data-date'), entries.innerHTML);
      }, 400);
    });

    entries.addEventListener('dblclick', () => {
      const text = prompt('Adicionar evento rápido:');
      if(text && text.trim()){
        const ev = document.createElement('div');
        ev.textContent = text.trim();
        entries.prepend(ev);
        saveEntry(entries.getAttribute('data-date'), entries.innerHTML);
      }
    });

    grid.appendChild(cell);
  }
}

prevBtn.addEventListener('click', () => {
  viewMonth--;
  if(viewMonth < 0){ viewMonth = 11; viewYear--; }
  renderCalendar(viewYear, viewMonth);
});
nextBtn.addEventListener('click', () => {
  viewMonth++;
  if(viewMonth > 11){ viewMonth = 0; viewYear++; }
  renderCalendar(viewYear, viewMonth);
});
todayBtn.addEventListener('click', () => {
  const d = new Date();
  viewYear = d.getFullYear();
  viewMonth = d.getMonth();
  renderCalendar(viewYear, viewMonth);
});

buildWeekdays();
renderCalendar(viewYear, viewMonth);
</script>

</body>
</html>
